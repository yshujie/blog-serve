version: '3.8'
services:
  backend:
    image: yshujie/miniblog:prod      # 不再 build，只用已构建好的镜像
    extra_hosts:
      - "host.docker.internal:host-gateway"
    network_mode: "host"
    environment:
      - DB_HOST=127.0.0.1
      - DB_PORT=3306
      - DB_USER=miniblog
      - DB_PASSWORD=miniblog123
      - DB_NAME=miniblog
      - REDIS_HOST=127.0.0.1
      - REDIS_PORT=6379
      - DB_DSN=miniblog:miniblog123@tcp(127.0.0.1:3306)/miniblog?charset=utf8mb4&parseTime=True&loc=Local
    restart: always
    ports:
      - "8081:8081"
    volumes:
      - /data/logs/miniblog:/data/logs/miniblog
      - /root/.config/ssl:/etc/miniblog/ssl:ro

  frontend:
    image: yshujie/miniblog-frontend:prod
    extra_hosts:
      - "host.docker.internal:host-gateway"
    network_mode: "host"
    restart: always
    ports:
      - "3000:3000"