version: '3.8'
services:
  backend:
    build:
      context: ../../..               # 回到项目根
      dockerfile: build/docker/miniblog/Dockerfile.prod.backend
      args:
        GOPROXY: https://goproxy.cn,direct
        HTTP_PROXY: ${HTTP_PROXY}
        HTTPS_PROXY: ${HTTPS_PROXY}
    image: yshujie/miniblog-backend:prod
    ports:
      - "8081:8081"
    environment:
      - CONFIG=/etc/miniblog/config.yaml
    volumes:
      - ../../../configs/miniblog.yaml:/etc/miniblog/config.yaml:ro

  frontend:
    build:
      context: ../../../web/miniblog-web  # 或者你统一搬到 build/docker/miniblog
      dockerfile: Dockerfile.prod.frontend
      args:
        GOPROXY: https://goproxy.cn,direct
        HTTP_PROXY: ${HTTP_PROXY}
        HTTPS_PROXY: ${HTTPS_PROXY}
    image: yshujie/miniblog-frontend:prod
    ports:
      - "3000:3000"